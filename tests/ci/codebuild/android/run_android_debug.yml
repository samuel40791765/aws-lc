version: 0.2

phases:
  build:
    commands:
      - chmod +x ./tests/ci/android/AWSLCAndroidTestRunner/gradlew
      - cd tests/ci/android/AWSLCAndroidTestRunner
      - ./gradlew assembleDebug assembleAndroidTest
      - mkdir "$CODEBUILD_SRC_DIR/apk-artifacts"
      - mv app/build/outputs/apk "$CODEBUILD_SRC_DIR/apk-artifacts/non-fips-dbg"
      - APK="$CODEBUILD_SRC_DIR/apk-artifacts/non-fips-dbg/debug/awslc_androidrunner_dbg.apk"
      - TEST_APK="$CODEBUILD_SRC_DIR/apk-artifacts/non-fips-dbg/androidTest/debug/awslc_androidrunner_dbg-androidTest.apk"
      - cd tests/ci/cdk/
      - python3 -m venv .env && . .env/bin/activate && pip install -r requirements.txt
      - ./kickoff_devicefarm.sh --action start-job
artifacts:
  files:
     - './tests/ci/android/AWSLCAndroidTestRunner/apk-artifacts/**/**/*.apk'
  name: AWSLCAndroidTestRunner-artifacts
  discard-paths: yes

